/*
 * @svg-drawing/react v5.0.1-beta.0 
 * 
 * Copyright (C) Kazuto Kamei.
 * This source code is licensed under the MIT license.
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),e=require("@svg-drawing/core"),n=require("@svg-drawing/img-trace");function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=r(t);var a=function(t){var e=t.fill;return o.default.createElement("rect",{style:{pointerEvents:"none"},width:"100%",height:"100%",fill:e})},u=["onSelectSvg","background","children"],i=function(e){var n=e.x,r=e.y,a=e.width,u=e.height,i=e.vertex,s=e.selected,f=e.onTranslateStart,h=e.onResizeStart,d=t.useCallback((function(t){f(l(t))}),[f]),p=t.useCallback((function(t){return function(e){h({fixedType:t,point:l(e)})}}),[h]);return o.default.createElement(o.default.Fragment,null,o.default.createElement("rect",{x:n,y:r,width:a,height:u,stroke:c.color.main,fill:s?c.fill.selected:c.fill.boundingBox,onMouseDown:d,onTouchStart:d}),Object.entries(i).map((function(t){var e=t[0],n=t[1];return o.default.createElement("circle",{key:e,cx:n.x,cy:n.y,r:c.point,stroke:c.color.main,fill:s?c.fill.selected:c.fill.boundingBox,onMouseDown:p(e),onTouchStart:p(e)})})))},c={line:1,point:3,color:{main:"#09f",sub:"#f90",selected:"#f00"},fill:{default:"none",boundingBox:"rgba(0,0,0,0)",selected:"rgba(0,0,0,0.1)"}},l=function(t){if("touches"in t){var e=t.touches[0];return{x:e.clientX,y:e.clientY}}return{x:t.clientX,y:t.clientY}},s=function(e){void 0===e&&(e=30);var n=t.useRef(null),r=t.useCallback((function(t){n.current=function(){n.current=null,t()}}),[]);return t.useEffect((function(){var t=setInterval((function(){n.current&&n.current()}),e);return function(){return clearInterval(t)}}),[e,r]),r},f=function(e){var n=e.ref,r=e.handler,o=e.active,a=void 0===o||o;t.useEffect((function(){var t=function(){return r.off()};if(!n.current)return t;var e=n.current;return r.setElement(e),a&&r.on(),t}),[a,r,n])},h=function(e){var n=t.useRef(!1);return t.useEffect((function(){var t=function(t){t.key===e&&(n.current=!0)},r=function(t){t.key===e&&(n.current=!1)};return addEventListener("keydown",t),addEventListener("keyup",r),function(){removeEventListener("keydown",t),removeEventListener("keyup",r)}}),[e]),n};function d(){return d=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},d.apply(this,arguments)}function p(t,e,n,r,o,a,u){try{var i=t[a](u),c=i.value}catch(t){return void n(t)}i.done?e(c):Promise.resolve(c).then(r,o)}function v(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function u(t){p(a,r,o,u,i,"next",t)}function i(t){p(a,r,o,u,i,"throw",t)}u(void 0)}))}}function y(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var g={exports:{}},m={exports:{}};
/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
!function(t){var e=function(t){var e,n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",i=o.toStringTag||"@@toStringTag";function c(t,e,n,r){var o=e&&e.prototype instanceof v?e:v,a=Object.create(o.prototype),u=new O(r||[]);return a._invoke=function(t,e,n){var r=s;return function(o,a){if(r===h)throw new Error("Generator is already running");if(r===d){if("throw"===o)throw a;return C()}for(n.method=o,n.arg=a;;){var u=n.delegate;if(u){var i=S(u,n);if(i){if(i===p)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===s)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var c=l(t,e,n);if("normal"===c.type){if(r=n.done?d:f,c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=d,n.method="throw",n.arg=c.arg)}}}(t,n,u),a}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var s="suspendedStart",f="suspendedYield",h="executing",d="completed",p={};function v(){}function y(){}function g(){}var m={};m[a]=function(){return this};var w=Object.getPrototypeOf,x=w&&w(w(j([])));x&&x!==n&&r.call(x,a)&&(m=x);var b=g.prototype=v.prototype=Object.create(m);function E(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function k(t,e){function n(o,a,u,i){var c=l(t[o],t,a);if("throw"!==c.type){var s=c.arg,f=s.value;return f&&"object"==typeof f&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,u,i)}),(function(t){n("throw",t,u,i)})):e.resolve(f).then((function(t){s.value=t,u(s)}),(function(t){return n("throw",t,u,i)}))}i(c.arg)}var o;this._invoke=function(t,r){function a(){return new e((function(e,o){n(t,r,e,o)}))}return o=o?o.then(a,a):a()}}function S(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,S(t,n),"throw"===n.method))return p;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=l(r,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,p;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,p):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function j(t){if(t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,u=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return u.next=u}}return{next:C}}function C(){return{value:e,done:!0}}return y.prototype=b.constructor=g,g.constructor=y,g[i]=y.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,i in t||(t[i]="GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},E(k.prototype),k.prototype[u]=function(){return this},t.AsyncIterator=k,t.async=function(e,n,r,o,a){void 0===a&&(a=Promise);var u=new k(c(e,n,r,o),a);return t.isGeneratorFunction(n)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},E(b),b[i]="Generator",b[a]=function(){return this},b.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=j,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return i.type="throw",i.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var u=this.tryEntries[a],i=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var c=r.call(u,"catchLoc"),l=r.call(u,"finallyLoc");if(c&&l){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var u=a?a.completion:{};return u.type=t,u.arg=e,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(u)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),P(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),p}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}}(m);var w=y(g.exports=m.exports);exports.AnimatePaths=function(t){var e=t.paths,n=t.animatePaths;return o.default.createElement(o.default.Fragment,null,e.map((function(t,e){var r,a=t.key,u=t.attributes,i=null!=(r=null==n?void 0:n[a])?r:[];return o.default.createElement("path",Object.assign({key:e},u),i.map((function(t,e){t.type;var n=t.attributes;return o.default.createElement("animate",Object.assign({key:e},n))})))})))},exports.BackgroundRect=a,exports.EditBoundingBox=i,exports.EditPaths=function(e){var n=e.paths,r=e.editPaths,a=e.boundingBox,u=e.onTranslateStart,s=e.onResizeStart,f=e.onSelectPaths,h=t.useCallback((function(t){return function(e){f(t),u(l(e))}}),[f,u]),d=t.useCallback((function(t){return function(e){f({path:t}),u(l(e))}}),[f,u]);return o.default.createElement(o.default.Fragment,null,n.map((function(t){var e=t.key,n=t.attributes;return o.default.createElement("path",Object.assign({key:e},n,{onMouseDown:d(e),onTouchStart:d(e)}))})),a&&o.default.createElement(i,Object.assign({},a,{onTranslateStart:u,onResizeStart:s})),r&&Object.entries(r).map((function(t){var e=t[1],n=e.key,r=e.vertex,a=e.d;return o.default.createElement("g",{key:n},o.default.createElement("path",{d:a,strokeWidth:c.line,stroke:c.color.main,fill:c.fill.boundingBox,onMouseDown:d(n),onTouchStart:d(n)}),r.map((function(t,e){var n=t.points,r=t.d;return o.default.createElement("g",{key:e},o.default.createElement("path",{d:r,strokeWidth:c.line,stroke:c.color.main,fill:c.fill.default}),n.map((function(t,e){return o.default.createElement("circle",{key:e,cx:t.value.x,cy:t.value.y,onMouseDown:h(t.index),onTouchStart:h(t.index),r:c.point,style:{fill:t.selected?c.color.selected:c.color.sub}})})))})))})))},exports.Paths=function(t){var e=t.paths;return o.default.createElement(o.default.Fragment,null,e.map((function(t,e){t.type;var n=t.attributes;return o.default.createElement("path",Object.assign({key:e},n))})))},exports.Svg=function(e){var n=e.onSelectSvg,r=e.background,i=e.children,c=function(t,e){if(null==t)return{};var n,r,o={},a=Object.keys(t);for(r=0;r<a.length;r++)n=a[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(e,u),l=t.useRef(null),s=t.useCallback((function(t){l.current&&l.current.isSameNode(t.target)&&(null==n||n())}),[n]);return o.default.createElement("svg",Object.assign({ref:l,onMouseDown:s,onTouchStart:s},c),r&&o.default.createElement(a,{fill:r}),i)},exports.useAnimation=function(n){var r=n.onChangeAnimation,o=t.useMemo((function(){return new e.Animation}),[]),a=t.useCallback((function(t,e){o.setup(t,e)}),[o]),u=t.useCallback((function(t){o.initialize(t),r(o.toJson())}),[o,r]),i=t.useCallback((function(){r(null)}),[r]);return{instance:o,setup:a,update:u,clear:i}},exports.useDraw=function(n){var r=n.factory,o=n.svg,a=n.onChangeSvg,u=s(),i=t.useCallback((function(){u((function(){return a(o.toJson())}))}),[u,a,o]),c=t.useMemo((function(){return new e.Drawing(o,r,i)}),[o,r,i]),l=t.useCallback((function(){var t=o.paths;return o.paths=[],i(),t}),[o,i]),f=t.useCallback((function(){var t=o.paths.pop();return i(),t}),[o.paths,i]);return{draw:c,update:i,clear:l,undo:f}},exports.useDrawEventHandler=f,exports.useDrawFactory=function(n,r){var o=r.curve,a=r.close;return t.useMemo((function(){return new e.BasicDrawFactory(n,{curve:o,close:a})}),[a,o,n])},exports.useEdit=function(n){var r=n.multipleSelectBindKey,o=void 0===r?"Shift":r,a=n.editSvgObject,u=n.svg,i=n.onChangeEdit,c=n.onChangeSvg,l=t.useMemo((function(){return new e.EditSvg(u)}),[u]),f=s(),d=t.useCallback((function(){f((function(){i(l.toJson()),c(l.svg.toJson())}))}),[l,i,c,f]),p=t.useMemo((function(){return new e.Editing(l,(function(t){f((function(){i(t.toJson()),c(t.svg.toJson())}))}))}),[l,i,c,f]),v=t.useMemo((function(){return new e.TranslatePathHandler(p)}),[p]);t.useEffect((function(){return function(){return v.end()}}),[v]);var y=t.useMemo((function(){return new e.ResizePathHandler(p)}),[p]);t.useEffect((function(){return function(){return y.end()}}),[y]);var g=h(o),m=t.useCallback((function(t){return p.select(t,g.current)}),[p,g]),w=t.useCallback((function(t){p.changeAttributes(t)}),[p]),x=t.useCallback((function(){p.cancel()}),[p]),b=t.useCallback((function(){p.deletePaths()}),[p]),E=t.useCallback((function(t){p.translate(t)}),[p]),k=t.useCallback((function(t){v.start(t)}),[v]),S=t.useCallback((function(t){y.start(t)}),[y]),L=t.useMemo((function(){var t;return(t={}).Escape=x,t.ArrowRight=function(){return E({x:.5,y:0})},t.ArrowLeft=function(){return E({x:-.5,y:0})},t.ArrowUp=function(){return E({x:0,y:-.5})},t.ArrowDown=function(){return E({x:0,y:.5})},t.Backspace=b,t}),[x,b,E]),P=t.useMemo((function(){var t,e;return{editPaths:null!=(t=null==a?void 0:a.paths)?t:null,boundingBox:null!=(e=null==a?void 0:a.boundingBox)?e:null}}),[a]),O=P.editPaths,j=P.boundingBox;return{edit:p,keyboardMap:L,update:d,selectPaths:m,cancelSelect:x,changeAttributes:w,translate:E,deletePaths:b,editProps:{editPaths:O,boundingBox:j,onTranslateStart:k,onResizeStart:S,onSelectPaths:m}}},exports.useKeyboardBind=function(e){void 0===e&&(e={}),t.useEffect((function(){var t=function(t){var n=e[t.key];"function"==typeof n&&(t.preventDefault(),n())};return addEventListener("keydown",t),function(){removeEventListener("keydown",t)}}),[e])},exports.useParseFile=function(r){var o=r.svg;return t.useCallback(function(){var t=v(w.mark((function t(r){return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,a){var u=new FileReader;u.onerror=function(t){return a(t)},u.onload=function(){var r=v(w.mark((function r(a){var u,i,c,l,s,f;return w.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a.target&&"string"==typeof a.target.result){r.next=2;break}return r.abrupt("return");case 2:return u=a.target.result.split(","),i=u[0],c=u[1],"data:image/svg+xml;base64"===i&&(l=atob(c),o.copy(e.parseSVGString(l)),t()),r.next=6,new n.ImgLoader({corsenabled:!0}).fromUrl(a.target.result);case 6:s=r.sent,f=new n.ImgTrace({palettes:n.Palette.imageData(s)}).load(s),o.copy(f),t();case 10:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}(),u.readAsDataURL(r)})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[o])},exports.usePenHandler=function(n,r,o){var a=t.useMemo((function(){return new e.PenHandler(r)}),[]);f({ref:n,handler:a,active:o})},exports.usePencilHandler=function(n,r,o){var a=t.useMemo((function(){return new e.PencilHandler(r)}),[]);f({ref:n,handler:a,active:o})},exports.usePressedKey=h,exports.useRenderInterval=s,exports.useResize=function(n,r,o){void 0===o&&(o=!0);var a=t.useMemo((function(){return new e.ResizeHandler}),[]);t.useEffect((function(){var t=function(){return a.off()};if(!n.current)return t;var e=n.current;return a.setElement(e),a.setHandler(r),o&&a.on(),t}),[r,a,n,o])},exports.useSvg=function(n){return t.useMemo((function(){return new e.Svg(d({width:0,height:0},n||{}))}),[])};
//# sourceMappingURL=index.cjs.map
