/*
 * @svg-drawing/react v5.0.1-beta.0 
 * 
 * Copyright (C) Kazuto Kamei.
 * This source code is licensed under the MIT license.
 */
import e,{useRef as t,useCallback as n,useEffect as r,useMemo as o}from"react";import{Drawing as a,PencilHandler as l,PenHandler as s,BasicDrawFactory as c,EditSvg as i,Editing as u,TranslatePathHandler as d,ResizePathHandler as g,Svg as h,parseSVGString as m,Animation as p,ResizeHandler as f}from"@svg-drawing/core";import{ImgLoader as y,ImgTrace as v,Palette as w}from"@svg-drawing/img-trace";const b=t=>{let{fill:n}=t;return e.createElement("rect",{style:{pointerEvents:"none"},width:"100%",height:"100%",fill:n})},E=r=>{let{onSelectSvg:o,background:a,children:l,...s}=r;const c=t(null),i=n((e=>{c.current&&c.current.isSameNode(e.target)&&(null==o||o())}),[o]);return e.createElement("svg",Object.assign({ref:c,onMouseDown:i,onTouchStart:i},s),a&&e.createElement(b,{fill:a}),l)},k=t=>{let{paths:n}=t;return e.createElement(e.Fragment,null,n.map(((t,n)=>{let{type:r,attributes:o}=t;return e.createElement("path",Object.assign({key:n},o))})))},x=t=>{let{paths:r,editPaths:o,boundingBox:a,onTranslateStart:l,onResizeStart:s,onSelectPaths:c}=t;const i=n((e=>t=>{c(e),l(B(t))}),[c,l]),u=n((e=>t=>{c({path:e}),l(B(t))}),[c,l]);return e.createElement(e.Fragment,null,r.map((t=>{let{key:n,attributes:r}=t;return e.createElement("path",Object.assign({key:n},r,{onMouseDown:u(n),onTouchStart:u(n)}))})),a&&e.createElement(S,Object.assign({},a,{onTranslateStart:l,onResizeStart:s})),o&&Object.entries(o).map((t=>{let[,{key:n,vertex:r,d:o}]=t;return e.createElement("g",{key:n},e.createElement("path",{d:o,strokeWidth:P.line,stroke:P.color.main,fill:P.fill.boundingBox,onMouseDown:u(n),onTouchStart:u(n)}),r.map(((t,n)=>{let{points:r,d:o}=t;return e.createElement("g",{key:n},e.createElement("path",{d:o,strokeWidth:P.line,stroke:P.color.main,fill:P.fill.default}),r.map(((t,n)=>e.createElement("circle",{key:n,cx:t.value.x,cy:t.value.y,onMouseDown:i(t.index),onTouchStart:i(t.index),r:P.point,style:{fill:t.selected?P.color.selected:P.color.sub}}))))})))})))},S=t=>{let{x:r,y:o,width:a,height:l,vertex:s,selected:c,onTranslateStart:i,onResizeStart:u}=t;const d=n((e=>{i(B(e))}),[i]),g=n((e=>t=>{u({fixedType:e,point:B(t)})}),[u]);return e.createElement(e.Fragment,null,e.createElement("rect",{x:r,y:o,width:a,height:l,stroke:P.color.main,fill:c?P.fill.selected:P.fill.boundingBox,onMouseDown:d,onTouchStart:d}),Object.entries(s).map((t=>{let[n,r]=t;return e.createElement("circle",{key:n,cx:r.x,cy:r.y,r:P.point,stroke:P.color.main,fill:c?P.fill.selected:P.fill.boundingBox,onMouseDown:g(n),onTouchStart:g(n)})})))},P={line:1,point:3,color:{main:"#09f",sub:"#f90",selected:"#f00"},fill:{default:"none",boundingBox:"rgba(0,0,0,0)",selected:"rgba(0,0,0,0.1)"}},B=e=>{if("touches"in e){const t=e.touches[0];return{x:t.clientX,y:t.clientY}}return{x:e.clientX,y:e.clientY}},T=t=>{let{paths:n,animatePaths:r}=t;return e.createElement(e.Fragment,null,n.map(((t,n)=>{let{key:o,attributes:a}=t;const l=(null==r?void 0:r[o])??[];return e.createElement("path",Object.assign({key:n},a),l.map(((t,n)=>{let{type:r,attributes:o}=t;return e.createElement("animate",Object.assign({key:n},o))})))})))},D=function(e){void 0===e&&(e=30);const o=t(null),a=n((e=>{o.current=()=>{o.current=null,e()}}),[]);return r((()=>{const t=setInterval((()=>{o.current&&o.current()}),e);return()=>clearInterval(t)}),[e,a]),a},j=e=>{let{factory:t,svg:r,onChangeSvg:l}=e;const s=D(),c=n((()=>{s((()=>l(r.toJson())))}),[s,l,r]),i=o((()=>new a(r,t,c)),[r,t,c]),u=n((()=>{const e=r.paths;return r.paths=[],c(),e}),[r,c]),d=n((()=>{const e=r.paths.pop();return c(),e}),[r.paths,c]);return{draw:i,update:c,clear:u,undo:d}},O=e=>{let{ref:t,handler:n,active:o=!0}=e;r((()=>{const e=()=>n.off();if(!t.current)return e;const r=t.current;return n.setElement(r),o&&n.on(),e}),[o,n,t])},A=(e,t,n)=>{const r=o((()=>new l(t)),[]);O({ref:e,handler:r,active:n})},L=(e,t,n)=>{const r=o((()=>new s(t)),[]);O({ref:e,handler:r,active:n})},M=(e,t)=>{let{curve:n,close:r}=t;return o((()=>new c(e,{curve:n,close:r})),[r,n,e])},R=e=>{const n=t(!1);return r((()=>{const t=t=>{t.key===e&&(n.current=!0)},r=t=>{t.key===e&&(n.current=!1)};return addEventListener("keydown",t),addEventListener("keyup",r),()=>{removeEventListener("keydown",t),removeEventListener("keyup",r)}}),[e]),n},J=e=>{let{multipleSelectBindKey:t="Shift",editSvgObject:a,svg:l,onChangeEdit:s,onChangeSvg:c}=e;const h=o((()=>new i(l)),[l]),m=D(),p=n((()=>{m((()=>{s(h.toJson()),c(h.svg.toJson())}))}),[h,s,c,m]),f=o((()=>new u(h,(e=>{m((()=>{s(e.toJson()),c(e.svg.toJson())}))}))),[h,s,c,m]),y=o((()=>new d(f)),[f]);r((()=>()=>y.end()),[y]);const v=o((()=>new g(f)),[f]);r((()=>()=>v.end()),[v]);const w=R(t),b=n((e=>f.select(e,w.current)),[f,w]),E=n((e=>{f.changeAttributes(e)}),[f]),k=n((()=>{f.cancel()}),[f]),x=n((()=>{f.deletePaths()}),[f]),S=n((e=>{f.translate(e)}),[f]),P=n((e=>{y.start(e)}),[y]),B=n((e=>{v.start(e)}),[v]),T=o((()=>({Escape:k,ArrowRight:()=>S({x:.5,y:0}),ArrowLeft:()=>S({x:-.5,y:0}),ArrowUp:()=>S({x:0,y:-.5}),ArrowDown:()=>S({x:0,y:.5}),Backspace:x})),[k,x,S]),{editPaths:j,boundingBox:O}=o((()=>({editPaths:(null==a?void 0:a.paths)??null,boundingBox:(null==a?void 0:a.boundingBox)??null})),[a]);return{edit:f,keyboardMap:T,update:p,selectPaths:b,cancelSelect:k,changeAttributes:E,translate:S,deletePaths:x,editProps:{editPaths:j,boundingBox:O,onTranslateStart:P,onResizeStart:B,onSelectPaths:b}}},z=e=>o((()=>new h({width:0,height:0,...e||{}})),[]),F=function(e){void 0===e&&(e={}),r((()=>{const t=t=>{const n=e[t.key];"function"==typeof n&&(t.preventDefault(),n())};return addEventListener("keydown",t),()=>{removeEventListener("keydown",t)}}),[e])},C=e=>{let{svg:t}=e;return n((async e=>new Promise(((n,r)=>{const o=new FileReader;o.onerror=e=>r(e),o.onload=async e=>{if(!e.target||"string"!=typeof e.target.result)return;const[r,o]=e.target.result.split(",");if("data:image/svg+xml;base64"===r){const e=atob(o);t.copy(m(e)),n()}const a=await new y({corsenabled:!0}).fromUrl(e.target.result),l=new v({palettes:w.imageData(a)}).load(a);t.copy(l),n()},o.readAsDataURL(e)}))),[t])},U=e=>{let{onChangeAnimation:t}=e;const r=o((()=>new p),[]),a=n(((e,t)=>{r.setup(e,t)}),[r]),l=n((e=>{r.initialize(e),t(r.toJson())}),[r,t]),s=n((()=>{t(null)}),[t]);return{instance:r,setup:a,update:l,clear:s}},I=function(e,t,n){void 0===n&&(n=!0);const a=o((()=>new f),[]);r((()=>{const r=()=>a.off();if(!e.current)return r;const o=e.current;return a.setElement(o),a.setHandler(t),n&&a.on(),r}),[t,a,e,n])};export{T as AnimatePaths,b as BackgroundRect,S as EditBoundingBox,x as EditPaths,k as Paths,E as Svg,U as useAnimation,j as useDraw,O as useDrawEventHandler,M as useDrawFactory,J as useEdit,F as useKeyboardBind,C as useParseFile,L as usePenHandler,A as usePencilHandler,R as usePressedKey,D as useRenderInterval,I as useResize,z as useSvg};
//# sourceMappingURL=index.js.map
