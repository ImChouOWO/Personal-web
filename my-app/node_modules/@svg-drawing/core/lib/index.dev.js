/*
 * @svg-drawing/core v5.0.1-beta.0 
 * 
 * Copyright (C) Kazuto Kamei.
 * This source code is licensed under the MIT license.
 */
function t(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class e{constructor(e,s,i){this.svg=e,this.pathFactory=s,this.update=i,t(this,"_drawPath",void 0),t(this,"_drawPoints",void 0),this._drawPath=null,this._drawPoints=[],this.start=this.start.bind(this),this.dot=this.dot.bind(this),this.end=this.end.bind(this)}start(){this._drawPoints=[],this._drawPath=this.pathFactory.createPath(),this.svg.addPath(this._drawPath)}dot(t){this._drawPath&&(this._drawPoints.push(t),this._drawPath.updateCommands(this.pathFactory.createCommand(this._drawPoints)),this.update(this.svg))}end(){this._drawPath=null,this.update(this.svg)}}const s=t=>Math.round(1e5*t)/1e5;class i{constructor(e,i){t(this,"_x",void 0),t(this,"_y",void 0),this._x=s(e),this._y=s(i)}get x(){return this._x}get y(){return this._y}scale(t){return new i(this._x*t,this._y*t)}scaleX(t){return new i(this._x*t,this._y)}scaleY(t){return new i(this._x,this._y*t)}add(t){return new i(this._x+t.x,this._y+t.y)}sub(t){return new i(this._x-t.x,this._y-t.y)}clone(){return new i(this._x,this._y)}toJson(){return{x:this._x,y:this._y}}static fromVector(t){let{value:e,angle:s}=t;const n=s*Math.PI/180;return new i(Math.cos(n)*e,Math.sin(n)*e)}}const n=t=>t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),r=function(t,e){return void 0===e&&(e=2),+t.toFixed(e)};class a{constructor(t,e){void 0===e&&(e=[]),this.type=t,this.values=e}set points(t){t&&(this.values=t.reduce(((t,e)=>[...t,e.x,e.y]),[]))}get points(){return this.values.reduce(((t,e,s)=>s%2?t:[...t,new i(this.values[s-1],this.values[s])]),[])}get point(){}toString(){return`${this.type}${this.values.map((t=>r(t))).join(" ")}`}scale(t){return new a(this.type,this.values.map((e=>e*t)))}scaleX(t){return new a(this.type,this.points.reduce(((e,s)=>{const i=s.scale(t);return[...e,i.x,i.y]}),[]))}scaleY(t){return new a(this.type,this.points.reduce(((e,s)=>{const i=s.scaleY(t);return[...e,i.x,i.y]}),[]))}clone(){return new a(this.type,this.values.slice())}translate(t){return a.Types.a===this.type||(this.points=this.points.map((e=>e.add(t)))),this}static validTypes(t){return Object.values(a.Types).some((e=>e===t))}}t(a,"Types",{H:"H",h:"h",V:"V",v:"v",A:"A",a:"a"});class h{constructor(e){t(this,"type","m"),t(this,"relative",!1),t(this,"points",void 0),this.points=[e]}get values(){return this.points.reduce(((t,e)=>[...t,e.x,e.y]),[])}get point(){return this.points[0]}toString(){return`${this.type}${this.values.join(" ")}`}translate(t){return new h(this.point.add(t))}scale(t){return new h(this.point.scale(t))}scaleX(t){return new h(this.point.scaleX(t))}scaleY(t){return new h(this.point.scaleY(t))}clone(){return new h(this.point.clone())}}class o{constructor(e){t(this,"type","M"),t(this,"points",void 0),this.points=[e]}get values(){return this.points.reduce(((t,e)=>[...t,e.x,e.y]),[])}get point(){return this.points[0]}toString(){return`${this.type}${this.values.join(" ")}`}translate(t){return new o(this.point.add(t))}scale(t){return new o(this.point.scale(t))}scaleX(t){return new o(this.point.scaleX(t))}scaleY(t){return new o(this.point.scaleY(t))}clone(){return new o(this.point.clone())}}class l{constructor(e){t(this,"type","l"),t(this,"points",void 0),this.points=[e]}get values(){return this.points.reduce(((t,e)=>[...t,e.x,e.y]),[])}get point(){return this.points[0]}toString(){return`${this.type}${this.values.join(" ")}`}translate(t){return new l(this.point.add(t))}scale(t){return new l(this.point.scale(t))}scaleX(t){return new l(this.point.scaleX(t))}scaleY(t){return new l(this.point.scaleY(t))}clone(){return new l(this.point.clone())}}class d{constructor(e){t(this,"type","L"),t(this,"points",void 0),this.points=[e]}get values(){return this.points.reduce(((t,e)=>[...t,e.x,e.y]),[])}get point(){return this.points[0]}toString(){return`${this.type}${this.values.join(" ")}`}translate(t){return new d(this.point.add(t))}scale(t){return new d(this.point.scale(t))}scaleX(t){return new d(this.point.scaleX(t))}scaleY(t){return new d(this.point.scaleY(t))}clone(){return new d(this.point.clone())}}class u{constructor(e){this.points=e,t(this,"type","c")}get values(){return this.points.reduce(((t,e)=>[...t,e.x,e.y]),[])}get point(){return this.points[2]}toString(){return`${this.type}${this.values.join(" ")}`}translate(t){return new u(this.points.map((e=>e.add(t))))}scale(t){return new u(this.points.map((e=>e.scale(t))))}scaleX(t){return new u(this.points.map((e=>e.scaleX(t))))}scaleY(t){return new u(this.points.map((e=>e.scaleY(t))))}clone(){return new u(this.points.map((t=>t.clone())))}}class c{constructor(e){this.points=e,t(this,"type","C")}get values(){return this.points.reduce(((t,e)=>[...t,e.x,e.y]),[])}get point(){return this.points[2]}toString(){return`${this.type}${this.values.join(" ")}`}translate(t){return new c(this.points.map((e=>e.add(t))))}scale(t){return new c(this.points.map((e=>e.scale(t))))}scaleX(t){return new c(this.points.map((e=>e.scaleX(t))))}scaleY(t){return new c(this.points.map((e=>e.scaleY(t))))}clone(){return new c(this.points.map((t=>t.clone())))}}class p{constructor(e){this.points=e,t(this,"type","S")}get values(){return this.points.reduce(((t,e)=>[...t,e.x,e.y]),[])}get point(){return this.points[1]}toString(){return`${this.type}${this.values.join(" ")}`}translate(t){return new p(this.points.map((e=>e.add(t))))}scale(t){return new p(this.points.map((e=>e.scale(t))))}scaleX(t){return new p(this.points.map((e=>e.scaleX(t))))}scaleY(t){return new p(this.points.map((e=>e.scaleY(t))))}clone(){return new p(this.points.map((t=>t.clone())))}}class m{constructor(e){this.points=e,t(this,"type","s")}get values(){return this.points.reduce(((t,e)=>[...t,e.x,e.y]),[])}get point(){return this.points[1]}toString(){return`${this.type}${this.values.join(" ")}`}translate(t){return new m(this.points.map((e=>e.add(t))))}scale(t){return new m(this.points.map((e=>e.scaleX(t))))}scaleX(t){return new m(this.points.map((e=>e.scaleX(t))))}scaleY(t){return new m(this.points.map((e=>e.scaleY(t))))}clone(){return new m(this.points.map((t=>t.clone())))}}class v{constructor(e){this.points=e,t(this,"type","Q")}get values(){return this.points.reduce(((t,e)=>[...t,e.x,e.y]),[])}get point(){return this.points[1]}toString(){return`${this.type}${this.values.join(" ")}`}translate(t){return new v(this.points.map((e=>e.add(t))))}scale(t){return new v(this.points.map((e=>e.scale(t))))}scaleX(t){return new v(this.points.map((e=>e.scaleX(t))))}scaleY(t){return new v(this.points.map((e=>e.scaleY(t))))}clone(){return new v(this.points.map((t=>t.clone())))}}class g{constructor(e){this.points=e,t(this,"type","q")}get values(){return this.points.reduce(((t,e)=>[...t,e.x,e.y]),[])}get point(){return this.points[1]}toString(){return`${this.type}${this.values.join(" ")}`}translate(t){return new g(this.points.map((e=>e.add(t))))}scale(t){return new g(this.points.map((e=>e.scaleX(t))))}scaleX(t){return new g(this.points.map((e=>e.scaleX(t))))}scaleY(t){return new g(this.points.map((e=>e.scaleY(t))))}clone(){return new g(this.points.map((t=>t.clone())))}}class w{constructor(){t(this,"type","z")}get values(){return[]}get points(){return[]}get point(){}toString(){return`${this.type}`}translate(t){return new w}scale(t){return new w}scaleX(t){return new w}scaleY(t){return new w}clone(){return new w}}const y=function(t,e){switch(void 0===e&&(e=[]),t){case"M":return new o(new i(e[0],e[1]));case"m":return new h(new i(e[0],e[1]));case"L":return new d(new i(e[0],e[1]));case"l":return new l(new i(e[0],e[1]));case"C":return new c([new i(e[0],e[1]),new i(e[2],e[3]),new i(e[4],e[5])]);case"c":return new u([new i(e[0],e[1]),new i(e[2],e[3]),new i(e[4],e[5])]);case"Q":return new v([new i(e[0],e[1]),new i(e[2],e[3])]);case"q":return new g([new i(e[0],e[1]),new i(e[2],e[3])]);case"S":return new p([new i(e[0],e[1]),new i(e[2],e[3])]);case"s":return new m([new i(e[0],e[1]),new i(e[2],e[3])]);case"Z":case"z":return new w;default:return new a(t,e)}},x=t=>["M","L","C","Q","S"].includes(t.type),f=t=>["m","l","c","q","s"].includes(t.type),b=t=>["c","C"].includes(t.type),_=t=>["h","H","v","V","a","A","z","Z"].includes(t.type),P=(t,e)=>{switch(t.type){case"M":return new h(t.point.sub(e));case"L":return new l(t.point.sub(e));case"C":return new u(t.points.map((t=>t.sub(e))));case"Q":return new g(t.points.map((t=>t.sub(e))));case"S":return new m(t.points.map((t=>t.sub(e))));default:throw new Error("toRelativeCommand error")}},E=(t,e)=>{switch(t.type){case"m":return new o(t.point.add(e));case"l":return new d(t.point.add(e));case"c":return new c(t.points.map((t=>t.add(e))));case"q":return new v(t.points.map((t=>t.add(e))));case"s":return new p(t.points.map((t=>t.add(e))));default:throw new Error("toAbsoluteCommand error")}},C=t=>{if(0===t.length)return[];let e=t[0].point;const s=[t[0]];for(let i=1;i<t.length;i+=1){const n=t[i],r=e&&x(n)?P(n,e):n.clone();e=x(n)?n.point:e&&n.point?e.add(n.point):void 0,s.push(r)}return s},S=t=>{if(0===t.length)return[];let e=t[0].point;const s=[t[0]];for(let i=1;i<t.length;i+=1){const n=t[i],r=e&&f(n)?E(n,e):n.clone();e=x(n)?n.point:e&&n.point?e.add(n.point):void 0,s.push(r)}return s};class L{constructor(t,e){this.value=t,this.angle=e}scale(t){return new L(this.value*t,this.angle)}rotate(t){return new L(this.value,this.angle+t)}toJson(){return{value:this.value,angle:this.angle}}static fromPoint(t){let{x:e,y:s}=t;return new L(Math.sqrt(Math.pow(e,2)+Math.pow(s,2)),Math.atan2(s,e)*(180/Math.PI))}}const z=t=>t.map(((t,e)=>0===e?new o(new i(t.x,t.y)):new d(new i(t.x,t.y))));class k{constructor(e){let{ratio:s}=void 0===e?{}:e;t(this,"ratio",void 0),this.ratio=s??.4,this.create=this.create.bind(this)}genCommand(t,e,s,n){const r=L.fromPoint(new i(s.x,s.y).sub(new i(e.x,e.y))).scale(this.ratio).value,a=i.fromVector({angle:L.fromPoint(new i(s.x,s.y).sub(new i(t.x,t.y))).angle,value:r}),h=i.fromVector({angle:L.fromPoint(new i(e.x,e.y).sub(new i(n.x,n.y))).angle,value:r}),o=new i(e.x,e.y).add(a),l=new i(s.x,s.y).add(h);return new c([o,l,new i(s.x,s.y)])}create(t){const e=[];if(t.length<3)return z(t);for(let s=0;s<t.length;s+=1)0!==s?e.push(this.genCommand(t[s-2<0?0:s-2],t[s-1],t[s],s<t.length-1?t[s+1]:t[s])):e.push(new o(new i(t[s].x,t[s].y)));return e}}const B=t=>[...t,new w];class A{constructor(e,s){void 0===e&&(e={}),this.attrs=e,t(this,"commands",[]),t(this,"key",void 0),this.key=s||`p${A.genIndex()}`}get absoluteCommands(){return S(this.commands)}get relativeCommands(){return C(this.commands)}updateCommands(t){return this.commands=C(t),this}scale(t){return this.updateCommands(this.commands.map((e=>e.scale(t)))),this}scaleX(t){return this.updateCommands(this.commands.map((e=>e.scaleX(t)))),this}scaleY(t){return this.updateCommands(this.commands.map((e=>e.scaleY(t)))),this}addCommand(t){return this.updateCommands([...this.commands,t].flat()),this}updateCommand(t,e){const s=this.absoluteCommands;return s[t]=e(s[t]),this.updateCommands(s),this}deleteCommand(t){return this.updateCommands(this.absoluteCommands.filter(((e,s)=>s!==t))),this}getCommandString(){var t;return(null==(t=this.relativeCommands)?void 0:t.map(((t,e)=>t.toString())).join(" ").trim())||""}toJson(){return{key:this.key,type:"path",attributes:{...this.attrs,d:this.getCommandString()}}}setAttributes(t){return this.attrs=t,this}updateAttributes(t){return this.attrs={...this.attrs,...t},this}translate(t){return this.updateCommands(this.absoluteCommands.map((e=>e.translate(t)))),this}clone(){return new A({...this.attrs},this.key).addCommand(this.commands.map((t=>t.clone())))}}t(A,"index",0),t(A,"genIndex",(()=>A.index+=1));class M{constructor(t,e){void 0===e&&(e={}),this.attrs=t,this.opts=e,this.opts={curve:!0,close:!1,...e}}createPath(){return new A({...this.attrs,...this.curveAttribute})}get createCommand(){const t=this.opts.curve?(new k).create:z;return e=>this.opts.close?B(t(e)):t(e)}setPathAttributes(t){this.attrs=t}updatePathAttributes(t){this.attrs={...this.attrs,...t}}changeCurve(t){this.opts={...this.opts,curve:t}}changeClose(t){this.opts={...this.opts,curve:t}}get curveAttribute(){return{strokeLinecap:this.opts.curve?"round":"mitter",strokeLinejoin:this.opts.curve?"round":"square"}}}const R="undefined"!=typeof PointerEvent,T="undefined"!=typeof ontouchstart,X=(()=>{try{const t=()=>null;return addEventListener("testPassive",t,{passive:!0}),removeEventListener("testPassive",t),!0}catch(t){return!1}})(),Y=t=>{if("touches"in t){const e=t.touches.length?t.touches[0]:t.changedTouches[0];return{x:e.clientX,y:e.clientY,pressure:e.force}}return{x:t.clientX,y:t.clientY,pressure:"pressure"in t?t.pressure:void 0}};function j(t,e){let s,i,n,r=null,a=0;const h=()=>{a=Date.now(),r=null,n=t.apply(s,i),r||(s=null,i=null)};return function(){const o=Date.now(),l=e-(o-a);s=this;for(var d=arguments.length,u=new Array(d),c=0;c<d;c++)u[c]=arguments[c];return i=u,l<=0||l>e?(r&&(clearTimeout(r),r=null),a=o,n=t.apply(s,i),r||(s=null,i=null)):r||(r=setTimeout(h,l)),n}}class ${constructor(e){this.el=e,t(this,"left",void 0),t(this,"top",void 0);const{left:s,top:i}=e?e.getBoundingClientRect():{left:0,top:0};this.left=s,this.top=i}setElement(t){this.el=t}setup(){const t=this.el;if(!t)return[];const e=()=>{const{left:e,top:s}=t.getBoundingClientRect();this.left=e,this.top=s};return e(),addEventListener("scroll",e),t.addEventListener("resize",e),[()=>{removeEventListener("scroll",e),t.removeEventListener("resize",e)}]}}class D{constructor(e,s){this.drawing=e,this.el=s,t(this,"_clearEventList",void 0),t(this,"_offsetPosition",void 0),this.on=this.on.bind(this),this.off=this.off.bind(this),this.setDrawing=this.setDrawing.bind(this),this._offsetPosition=new $(s),this._clearEventList=[]}get isActive(){return this._clearEventList.length>0}off(){this._clearEventList.map((t=>t())),this._clearEventList=[]}on(){this.off(),this._clearEventList=[...this._offsetPosition.setup(),...this.setupListener()]}setElement(t){this.el=t,this._offsetPosition.setElement(t),this.isActive&&this.on()}setDrawing(t){this.drawing=t,this.isActive&&this.on()}getPointObjectFromDrawEvent(t){const{x:e,y:s,pressure:i}=Y(t);return{x:e-this._offsetPosition.left,y:s-this._offsetPosition.top,pressure:i}}}class O extends D{constructor(e,s){super(e,s),t(this,"_drawMoveThrottle",void 0),t(this,"delay",20),t(this,"listenerOption",void 0),this.setDrawing=this.setDrawing.bind(this),this._handleStart=this._handleStart.bind(this),this._handleMove=this._handleMove.bind(this),this._handleEnd=this._handleEnd.bind(this),this._drawMoveThrottle=j(this.drawing.dot,this.delay).bind(this),this.listenerOption=!!X&&{passive:!1}}changeDelay(t){this.delay=t,this._drawMoveThrottle=j(this.drawing.dot,this.delay),this.isActive&&this.on()}setDrawing(t){this.drawing=t,this._drawMoveThrottle=j(this.drawing.dot,this.delay),this.isActive&&this.on()}setupListener(){return R?this._setupDrawListener("pointer"):T?this._setupDrawListener("touch"):this._setupDrawListener("mouse")}_handleStart(t){t.preventDefault(),this.drawing.start()}_handleEnd(t){t.preventDefault(),this.drawing.end()}_handleMove(t){t.preventDefault(),this._drawMoveThrottle(this.getPointObjectFromDrawEvent(t))}_setupDrawListener(t){const e=this.el;if(!e)return[];const{start:s,move:i,end:n,flameout:r}={pointer:{start:["pointerdown"],move:["pointermove"],end:["pointerleave","pointercancel"],flameout:["pointerup"]},touch:{start:["touchstart"],move:["touchmove"],end:["touchend"],flameout:["touchcancel"]},mouse:{start:["mousedown"],move:["mousemove"],end:["mouseleave","mouseout"],flameout:["mouseup"]}}[t];return[...s.map((t=>(e.addEventListener(t,this._handleStart,this.listenerOption),()=>e.removeEventListener(t,this._handleStart)))),...i.map((t=>(e.addEventListener(t,this._handleMove,this.listenerOption),()=>e.removeEventListener(t,this._handleMove)))),...n.map((t=>(e.addEventListener(t,this._handleEnd,this.listenerOption),()=>e.removeEventListener(t,this._handleEnd)))),...r.map((t=>(addEventListener(t,this._handleEnd,this.listenerOption),()=>removeEventListener(t,this._handleEnd))))]}}class I extends D{constructor(e,s){super(e,s),t(this,"_editing",void 0),this._editing=!1,this._handleProt=this._handleProt.bind(this)}setupListener(){const t=[...this._setupCancelListener()];return R?[...this._setupDrawListener("pointer"),...t]:T?[...this._setupDrawListener("touch"),...t]:[...this._setupDrawListener("mouse"),...t]}_handleProt(t){t.preventDefault();const e=this._isContainElement(t);if(!this._editing&&e)return this.drawing.start(),this.drawing.dot(this.getPointObjectFromDrawEvent(t)),void(this._editing=!0);e?this.drawing.dot(this.getPointObjectFromDrawEvent(t)):(this._editing=!1,this.drawing.end())}_isContainElement(t){return!!this.el&&this.el.contains(t.target)}_setupCancelListener(){const t=setInterval((()=>{document.hasFocus()||(this._editing=!1,this.drawing.end())}),1e3);return[()=>clearInterval(t)]}_setupDrawListener(t){const e={touch:"touchstart",pointer:"pointerup",mouse:"mouseup"};return addEventListener(e[t],this._handleProt),[()=>{removeEventListener(e[t],this._handleProt)}]}}class J{constructor(e){let{width:s,height:i,background:n}=e;t(this,"paths",void 0),t(this,"width",void 0),t(this,"height",void 0),t(this,"background",void 0),this.paths=[],this.width=s,this.height=i,this.background=n}resize(t){let{width:e,height:s}=t;this.scale(e/this.width),this.width=e,this.height=s}scale(t){if(1!==t&&isFinite(t)&&0!==t)for(let e=0;e<this.paths.length;e+=1)this.paths[e].scale(t);return this}addPath(t){return Array.isArray(t)?this.paths.push(...t):this.paths.push(t),this}getPath(t){return this.paths.find((e=>e.key===t))}updatePath(t){const e=this.paths.findIndex((e=>e.key===t.key));return-1!==e&&(this.paths[e]=t),this}deletePath(t){return this.paths=this.paths.filter((e=>e.key!==t.key)),this}clonePaths(){return this.paths.map((t=>t.clone()))}toJson(){return{width:this.width,height:this.height,background:this.background,paths:this.paths.map((t=>t.toJson()))}}copy(t){return this.paths=t.clonePaths(),t.width&&this.width&&this.scale(this.width/t.width),this}clone(){const t=new J({width:this.width,height:this.height,background:this.background});return t.addPath(this.clonePaths()),t}}const{pow:F}=Math,q=function(t,e){void 0===e&&(e=10);const{a:s,b:i,c:n}=(t=>{let[e,s,i,n]=t;const r={x:3*(s.x-e.x),y:3*(s.y-e.y)},a={x:3*(i.x-s.x)-r.x,y:3*(i.y-s.y)-r.y};return{a:{x:n.x-e.x-r.x-a.x,y:n.y-e.y-r.y-a.y},b:a,c:r}})(t),r=t[0],a=1/e;return Array.from({length:e+1}).map(((t,h)=>{return o=0===h?0:h===e?1:h*a,{x:s.x*F(o,3)+i.x*F(o,2)+n.x*o+r.x,y:s.y*F(o,3)+i.y*F(o,2)+n.y*o+r.y};var o}))},N={x:0,y:0};class U{constructor(t){this.paths=t}get points(){return this.paths.flatMap((t=>{let e;return t.absoluteCommands.flatMap((t=>{const s=((t,e)=>{let{base:s,range:i=10}=e;if(!t.point)return[];if(b(t)){const e=s||t.points[0].toJson(),n=t.points.map((t=>t.toJson()));return q([e,...n],i)}return[t.point.toJson()]})(t,{base:e});return e=t.point?t.point.toJson():void 0,s}))}))}get pointsX(){return this.points.map((t=>t.x))}get pointsY(){return this.points.map((t=>t.y))}get min(){return 0===this.points.length?N:{x:Math.min(...this.pointsX),y:Math.min(...this.pointsY)}}get max(){return 0===this.points.length?N:{x:Math.max(...this.pointsX),y:Math.max(...this.pointsY)}}get width(){return this.max.x-this.min.x}get height(){return this.max.y-this.min.y}get vertex(){return{LeftTop:{x:this.min.x,y:this.min.y},RightTop:{x:this.max.x,y:this.min.y},RightBottom:{x:this.max.x,y:this.max.y},LeftBottom:{x:this.min.x,y:this.max.y}}}resizeParams(t,e){const s=this.width,i=this.height;switch(t){case"LeftTop":{const t={x:(s-e.x)/s,y:(i-e.y)/i};return{scale:t,move:{x:-(this.max.x*t.x-this.max.x),y:-(this.max.y*t.y-this.max.y)}}}case"RightTop":{const t={x:(s+e.x)/s,y:(i-e.y)/i};return{scale:t,move:{x:-(this.min.x*t.x-this.min.x),y:-(this.max.y*t.y-this.max.y)}}}case"LeftBottom":{const t={x:(s-e.x)/s,y:(i+e.y)/i};return{scale:t,move:{x:-(this.max.x*t.x-this.max.x),y:-(this.min.y*t.y-this.min.y)}}}case"RightBottom":{const t={x:(s+e.x)/s,y:(i+e.y)/i};return{scale:t,move:{x:-(this.min.x*t.x-this.min.x),y:-(this.min.y*t.y-this.min.y)}}}}}}class V{constructor(t,e){this.path=t,this.selector=e}toJson(){return{key:this.path.key,d:this.path.getCommandString(),vertex:this.vertex}}get vertex(){const t=[],e=this.path.absoluteCommands;for(let h=0;h<e.length;h+=1){var s,i,n,r;const o=e[h],l=e[h+1],d=[null==(s=o.points[1])?void 0:s.toJson(),null==(i=o.points[2])?void 0:i.toJson(),null==l||null==(n=l.points[0])?void 0:n.toJson()].filter((t=>!!t)),u=null==(r=this.selector)?void 0:r.getPointsIndex(this.path.key,h);t.push({points:o.points.map(((t,e)=>({index:{path:this.path.key,command:h,point:e},value:t.toJson(),selected:(null==u?void 0:u.includes(e))??!1}))),d:(a=d,a.reduce(((t,e,s)=>0===s?`M ${e.x} ${e.y}`:t+`L ${e.x} ${e.y}`),""))})}var a;return t}}const H=t=>({[t.path]:"number"==typeof t.command?{[t.command]:"number"==typeof t.point?[t.point]:[]}:{}}),Q=t=>0===Object.keys(t).length;class G{constructor(){t(this,"selecting",{})}get selectedPathsOnly(){return this.selected&&Object.keys(this.selecting).every((t=>this.selecting&&0===Object.keys(this.selecting[t]).length))}get selected(){return!Q(this.selecting)}get pathsIndex(){return Object.keys(this.selecting)}getCommandsIndex(t){const e=this.selecting[t];return e&&!Q(e)?Object.keys(e).map(Number):void 0}getPointsIndex(t,e){var s;const i=null==(s=this.selecting[t])?void 0:s[e];return i&&!Q(i)?i:void 0}clear(){this.selecting={}}select(t){this.selecting=H(t)}selectMerge(t){this.selecting={...this.selecting,...H(t)}}unselect(t){if(!this.selecting)return;const{[t.path]:e,...s}=this.selecting;if(!e)return;if((t=>!(!t.path||"number"==typeof t.command||"number"==typeof t.point))(t))return void(this.selecting=s);const{[t.command]:i,...n}=e;i&&((t=>!(!t.path||"number"!=typeof t.command||"number"==typeof t.point))(t)?this.selecting={...this.selecting,[t.path]:n}:(t=>!(!t.path||"number"!=typeof t.command||"number"!=typeof t.point))(t)&&(this.selecting={...this.selecting,[t.path]:{...this.selecting[t.path],[t.command]:i.filter((e=>e!==t.point))}}))}}class Z{constructor(e){this.svg=e,t(this,"pathSelector",new G)}get selected(){return this.pathSelector.selected}select(t,e){e?this.pathSelector.selectMerge(t):this.pathSelector.select(t)}cancel(){this.pathSelector.clear()}changeAttributes(t){this.exec((e=>e.updateAttributes(t)))}translate(t){this.exec((e=>e.translate(t)),(e=>e.translate(t)),(e=>e.add(t)))}scale(t){this.exec((e=>e.scale(t)),(e=>e.scale(t)),(e=>e.scale(t)))}scaleX(t){this.exec((e=>e.scaleX(t)),(e=>e.scaleX(t)),(e=>e.scaleX(t)))}scaleY(t){this.exec((e=>e.scaleY(t)),(e=>e.scaleY(t)),(e=>e.scaleY(t)))}resizeBoundingBox(t,e){const{move:s,scale:i}=new U(this.paths).resizeParams(t,e);this.exec((t=>t.scaleX(i.x).scaleY(i.y).translate(s)))}delete(){this.pathSelector.pathsIndex.forEach((t=>{const e=this.pathSelector.getCommandsIndex(t),s=this.svg.getPath(t);if(s)return e?void e.forEach((e=>{this.pathSelector.unselect({path:t,command:e}),this.svg.updatePath(s.deleteCommand(e))})):(this.pathSelector.unselect({path:t}),void this.svg.deletePath(s))}))}preview(){const t=new Z(this.svg.clone());return t.pathSelector=this.pathSelector,t}toJson(){if(!this.pathSelector.selected)return null;const t=this.pathSelector.pathsIndex.reduce(((t,e)=>{const s=this.svg.paths.find((t=>t.key===e));return s?{...t,[s.key]:new V(s.clone(),this.pathSelector).toJson()}:t}),{}),{min:{x:e,y:s},width:i,height:n,vertex:r}=new U(this.paths);return{paths:t,boundingBox:{x:e,y:s,width:i,height:n,vertex:r,selected:this.pathSelector.selectedPathsOnly}}}get paths(){return this.pathSelector.pathsIndex.flatMap((t=>{const e=this.svg.paths.find((e=>e.key===t));return e?e.clone():[]}))}exec(t,e,s){this.pathSelector.pathsIndex.forEach((i=>{const n=this.svg.getPath(i);if(!n)return;const r=this.pathSelector.getCommandsIndex(i);r&&e?r.forEach((t=>{const r=this.pathSelector.getPointsIndex(i,t);r&&s?this.svg.updatePath(n.updateCommand(t,(t=>{const e=t.clone();return r.forEach((t=>{e.points[t]=s(e.points[t])})),e}))):this.svg.updatePath(n.updateCommand(t,e))})):this.svg.updatePath(t(n))}))}}class W{constructor(t,e){void 0===e&&(e=()=>{}),this.editSvg=t,this.updater=e,this.translate=this.translate.bind(this),this.translatePreview=this.translatePreview.bind(this),this.resize=this.resize.bind(this),this.resizePreview=this.resizePreview.bind(this)}setupUpdater(t){this.updater=t}cancel(){this.editSvg.cancel(),this.updater(this.editSvg)}select(t,e){this.editSvg.select(t,e),this.updater(this.editSvg)}deletePaths(){this.editSvg.delete(),this.updater(this.editSvg)}changeAttributes(t){this.editSvg.changeAttributes(t),this.updater(this.editSvg)}translatePreview(t){this.translateEditSvg(this.editSvg.preview(),t)}translate(t){this.translateEditSvg(this.editSvg,t)}translateEditSvg(t,e){t.translate(e),this.updater(t)}resize(t,e){this.resizeEditSvg(this.editSvg,t,e)}resizePreview(t,e){this.resizeEditSvg(this.editSvg.preview(),t,e)}resizeEditSvg(t,e,s){t.resizeBoundingBox(e,s),this.updater(t)}}class K{constructor(e){this.editing=e,t(this,"resizeBoundingBoxBase",null),this.handleResizePathEnd=this.handleResizePathEnd.bind(this),this.handleResizePathPreview=this.handleResizePathPreview.bind(this)}getResizeMovePoint(t){var e,s;const i=Y(t);return{x:i.x-((null==(e=this.resizeBoundingBoxBase)?void 0:e.point.x)??0),y:i.y-((null==(s=this.resizeBoundingBoxBase)?void 0:s.point.y)??0)}}handleResizePathPreview(t){this.resizeBoundingBoxBase&&this.editing.resizePreview(this.resizeBoundingBoxBase.fixedType,this.getResizeMovePoint(t))}handleResizePathEnd(t){var e;this.end(),this.resizeBoundingBoxBase&&(this.editing.resize(null==(e=this.resizeBoundingBoxBase)?void 0:e.fixedType,this.getResizeMovePoint(t)),this.resizeBoundingBoxBase=null)}start(t){this.resizeBoundingBoxBase=t,addEventListener("mouseup",this.handleResizePathEnd),addEventListener("touchend",this.handleResizePathEnd),addEventListener("mousemove",this.handleResizePathPreview),addEventListener("touchmove",this.handleResizePathPreview)}end(){removeEventListener("mouseup",this.handleResizePathEnd),removeEventListener("touchend",this.handleResizePathEnd),removeEventListener("mousemove",this.handleResizePathPreview),removeEventListener("touchmove",this.handleResizePathPreview)}}class tt{constructor(e){this.editing=e,t(this,"basePoint",void 0),this.basePoint=null,this.handleTranslateEnd=this.handleTranslateEnd.bind(this),this.handleTranslatePreview=this.handleTranslatePreview.bind(this)}handleTranslatePreview(t){this.editing.translatePreview(this.getTranslatePoint(t))}handleTranslateEnd(t){this.end(),this.editing.translate(this.getTranslatePoint(t)),this.basePoint=null}getTranslatePoint(t){var e,s;const i=Y(t);return{x:i.x-((null==(e=this.basePoint)?void 0:e.x)??0),y:i.y-((null==(s=this.basePoint)?void 0:s.y)??0)}}start(t){this.basePoint=t,addEventListener("mouseup",this.handleTranslateEnd),addEventListener("touchend",this.handleTranslateEnd),addEventListener("mousemove",this.handleTranslatePreview),addEventListener("touchmove",this.handleTranslatePreview)}end(){removeEventListener("mouseup",this.handleTranslateEnd),removeEventListener("touchend",this.handleTranslateEnd),removeEventListener("mousemove",this.handleTranslatePreview),removeEventListener("touchmove",this.handleTranslatePreview)}}const et="http://www.w3.org/2000/svg",st=(t,e)=>{const s=document.createElementNS(et,"svg");return s.setAttributeNS(null,"version","1.1"),s.setAttribute("xmlns",et),s.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),Object.keys(t).sort().map((e=>{s.setAttribute(e,t[e])})),e.map((t=>{s.appendChild(t)})),s},it=(t,e)=>{const s=document.createElementNS(et,t);return Object.keys(e).sort().map((t=>{s.setAttribute(t,e[t])})),s},nt=t=>{const e=Object.entries(t).reduce(((t,e,s)=>{let[i,r]=e;return r?{...t,[n(i)]:r}:t}),{});return it("path",e)},rt=t=>{let{width:e,height:s,background:i,paths:n}=t;const r={width:String(e),height:String(s)},a=i?[it("rect",{...r,fill:i})]:[];return st(r,[...a,...n.map((t=>{let{attributes:e}=t;return nt(e)}))])};class at{constructor(t,e){let{background:s}=void 0===e?{}:e;this.el=t;const{width:i,height:n}=this.el.getBoundingClientRect();this.el.appendChild(rt({background:s,width:i,height:n,paths:[]})),this.update=this.update.bind(this)}update(t){let{svg:e}=t;this.el.replaceChild(rt(e),this.el.childNodes[0])}}const ht={png:"image/png",jpg:"image/jpeg",svg:"image/svg+xml"},ot=t=>{var e;let{data:s,extension:i,filename:n}=t;const r=((t,e)=>{const s=Buffer.from(t.replace(/^.*,/,"")).toString(),i=new Uint8Array(s.length);for(let t=0;t<s.length;t+=1)i[t]=s.charCodeAt(t);return new Blob([i.buffer],{type:e})})(s,ht[i]);if(navigator.msSaveBlob)navigator.msSaveBlob(r,n);else{if(null!=(e=URL)&&e.createObjectURL){const t=document.createElement("a");return t.download=n,t.href=URL.createObjectURL(r),document.body.appendChild(t),t.click(),void document.body.removeChild(t)}open(s,"_blank")}};class lt{constructor(e,s){this.el=e,t(this,"download",void 0),this.download=s||ot}svg(t){this.download({data:this.toBase64(),extension:"svg",filename:t})}png(t){this.renderCanvas({filename:t,extension:"png"})}jpg(t){this.renderCanvas({filename:t,extension:"png"})}toBase64(){return`data:image/svg+xml;base64,${Buffer.from(this.el.outerHTML).toString("base64")}`}renderCanvas(t){let{filename:e,extension:s}=t;const i=new Image;i.addEventListener("load",(()=>{const t=document.createElement("canvas");t.setAttribute("width",String(this.el.width.animVal.value)),t.setAttribute("height",String(this.el.height.animVal.value));const n=t.getContext("2d");n&&(n.drawImage(i,0,0),this.download({data:t.toDataURL(ht[s]),extension:s,filename:e}))}),!1),i.src=this.toBase64()}}const dt="undefined"!=typeof ResizeObserver;class ut{constructor(e){void 0===e&&(e=null),this.el=e,t(this,"_clearEventList",void 0),t(this,"resizeCallback",void 0),t(this,"width",0),t(this,"height",0),t(this,"threshold",1),this.el=e,this.resizeCallback=()=>{},this._clearEventList=[]}get active(){return this._clearEventList.length>0}off(){this._clearEventList.map((t=>t())),this._clearEventList=[]}on(){this.off(),this._setupListener()}setElement(t){return this.el=t,this.active&&this.on(),this}setHandler(t){this.resizeCallback=t}resize(t){let{width:e,height:s}=t;this.width=e,this.height=s,this.resizeCallback({width:e,height:s})}handleResize(){if(!this.el)return;const{width:t,height:e}=this.el.getBoundingClientRect();Math.abs(this.width-t)<this.threshold&&Math.abs(this.height-e)<this.threshold||this.resize({width:t,height:e})}_setupListener(){if(this.el){if(this.handleResize(),dt){const t=new ResizeObserver((()=>this.handleResize()));return t.observe(this.el),void this._clearEventList.push((()=>t.disconnect()))}addEventListener("resize",this.handleResize),this._clearEventList.push((()=>removeEventListener("resize",this.handleResize)))}}}const ct=t=>{const e=(new DOMParser).parseFromString(t,"image/svg+xml").querySelector("svg");return e?pt(e):new J({width:0,height:0})},pt=t=>{const e=Number(t.getAttribute("width")),s=Number(t.getAttribute("height")),i=new J({width:e,height:s});return t.querySelectorAll("path").forEach((t=>{i.addPath(mt(t))})),i},mt=t=>{const e=new A;for(let i=0;i<t.attributes.length;i+=1){const n=t.attributes.item(i);n&&n.value&&("d"!==n.name?e.updateAttributes({[(s=n.name,s.replace(/-([a-z])/g,((t,e)=>e.toUpperCase())))]:n.value}):e.addCommand(vt(n.value)))}var s;return e},vt=t=>{const e=new RegExp("([mlsqlhvcsqaz])([^mlsqlhvcsqaz]*)","gi");return Array.from(t.matchAll(e)||[]).reduce(((t,e,s)=>{var i,n;const r=(null==(i=e[2])||null==(n=i.split(/[,\s]/))?void 0:n.reduce(((t,e)=>""===e?t:[...t,+e]),[]))||[];return[...t,y(e[1],r)]}),[])};class gt{constructor(s,i){let{curve:n=!0,close:r=!1,delay:a=0,penColor:h,penWidth:o,fill:l,background:d}=void 0===i?{}:i;t(this,"svg",void 0),t(this,"drawing",void 0),t(this,"factory",void 0),t(this,"handler",void 0),t(this,"renderer",void 0);const{width:u,height:c}=s.getBoundingClientRect();this.renderer=new at(s,{background:d}),this.update=this.update.bind(this),this.svg=new J({width:u,height:c,background:d}),this.factory=new M({stroke:h??"#000",strokeWidth:o||0===o?String(o):"1",fill:l??"none"},{curve:n,close:r}),this.drawing=new e(this.svg,this.factory,this.update);const p=new O(this.drawing,s);this.handler=p,p.changeDelay(a),this.handler.on()}drawStart(){this.drawing.start()}drawMove(t){this.drawing.dot(t)}drawEnd(){this.drawing.end()}toJson(){return this.svg.toJson()}changeCurve(t){this.factory.changeCurve(t)}changeClose(t){this.factory.changeClose(t)}clear(){const t=this.svg.paths;return this.svg.paths=[],this.update(),t}undo(){const t=this.svg.paths.pop();return this.update(),t}update(){this.renderer.update({svg:this.svg.toJson()})}resize(t){let{width:e,height:s}=t;var i,n;(i=this.svg.width,n=e,Math.trunc(i)!==Math.trunc(n))&&(this.svg.resize({width:e,height:s}),this.update())}}class wt{constructor(e){let{ms:s}=void 0===e?{ms:60}:e;t(this,"ms",void 0),t(this,"paths",void 0),t(this,"generator",void 0),t(this,"_frame",null),t(this,"_repeatCount",void 0),this.ms=s,this.paths=[]}setup(t,e){let{repeatCount:s,ms:i}=void 0===e?{}:e;this._frame=t,this._repeatCount=s||void 0,i&&(this.ms=i),this.generator=this.setupGenerator()}getFramePaths(t){const e=this.paths.map((t=>t.clone()));return e.length&&this._frame?this._frame.animation(e,t):e}restorePaths(){return this.paths.map((t=>t.clone()))}*setupGenerator(){let t=0,e=0;if(this._frame)for(;!this._repeatCount||e<this._repeatCount;)t>this._frame.loops?(e+=1,t=0):t+=1,yield this.getFramePaths(t)}initialize(t){return this.paths=t.map((t=>t.clone())),this.generator=this.setupGenerator(),this}toJson(){if(!this._frame)return{};const t=this._frame.loops,e=Array(this._frame.loops).fill(null),s=e.map(((t,e)=>this.getFramePaths(e))),i={repeatCount:`${this._repeatCount||"indefinite"}`,dur:t*(this.ms>0?this.ms:1)+"ms",keyTimes:e.reduce(((e,s,i)=>e+";"+r((i+1)*(1/t),4)),"0")};return this.paths.reduce(((t,e)=>{const{key:r,attributes:a}=e.toJson(),h=s.map((t=>t.find((t=>t.key===e.key))));return{...t,[r]:Object.keys(a).sort().reduce(((t,s)=>{const r=a[s];if(!r)return t;const o="d"===s?(l=e,h.map((t=>(null==t?void 0:t.getCommandString())||l.relativeCommands[0].toString()))):((t,e,s)=>t.map((t=>(null==t?void 0:t.attrs[e])||s)))(h,s,r);var l;return o.every((t=>t===r))?t:[...t,{...i,attributeName:n(s),values:[...o,r].join(";")}]}),[]).map((t=>({type:"animate",attributes:t})))}}),{})}}class yt{constructor(e,s,i){this.svg=e,this.animation=s,this.update=i,t(this,"_stopId",void 0),this.resize=this.resize.bind(this)}stop(){this._stopId&&(cancelAnimationFrame(this._stopId),this.restore())}restore(){this.svg.paths=this.animation.restorePaths(),this.update(this.svg)}start(){this.stop(),this._setupAnimation(),this._startAnimation()}_setupAnimation(){this.animation.initialize(this.svg.paths)}_updateFrame(){if(!this.animation.generator)return;const t=this.animation.generator.next();t.done?this.stop():(this.svg.paths=t.value,this.update(this.svg))}_startAnimation(){let t=0;const e=s=>{s-t>this.animation.ms&&(t=s,this._updateFrame()),this._stopId=requestAnimationFrame(e)};this._stopId=requestAnimationFrame(e)}toElement(){const t={width:String(this.svg.width),height:String(this.svg.height)},e=this.animation.toJson(),s=this.animation.paths.map((t=>{var s;const{key:i,attributes:n}=t.toJson(),r=nt(n);return null==e||null==(s=e[i])||s.map((t=>{let{type:e,attributes:s}=t;r.appendChild(it(e,s))})),r})),i=this.svg.background?[it("rect",{...t,fill:this.svg.background}),...s]:s;return st(t,i)}resize(t){let{width:e,height:s}=t;this.stop(),this.svg.resize({width:e,height:s}),this.animation.initialize(this.svg.paths),this.start()}static init(t,e){let{ms:s,background:i}=void 0===e?{ms:60}:e;const{width:n,height:r}=t.getBoundingClientRect();return new yt(new J({width:n,height:r}),new wt({ms:s}),(e=>new at(t,{background:i}).update({svg:e.toJson()})))}}export{wt as Animation,D as BaseHandler,M as BasicDrawFactory,k as BezierCurve,w as Close,c as Curve,lt as Download,e as Drawing,V as EditPath,Z as EditSvg,W as Editing,d as Line,o as Move,a as OtherCommand,A as Path,I as PenHandler,O as PencilHandler,i as Point,v as QuadraticCurve,u as RelativeCurve,l as RelativeLine,h as RelativeMove,g as RelativeQuadraticCurve,m as RelativeShortcutCurve,at as Renderer,ut as ResizeHandler,K as ResizePathHandler,J as Svg,yt as SvgAnimation,gt as SvgDrawing,tt as TranslatePathHandler,L as Vector,B as closeCommands,y as createCommand,z as createLineCommands,it as createSvgChildElement,st as createSvgElement,x as isAbsoluteCommand,b as isCurveCommand,_ as isOtherCommand,f as isRelativeCommand,vt as parseCommandString,mt as parsePathElement,pt as parseSVGElement,ct as parseSVGString,nt as pathObjectToElement,q as segmentPoint,rt as svgObjectToElement,E as toAbsoluteCommand,S as toAbsoluteCommands,P as toRelativeCommand,C as toRelativeCommands};
//# sourceMappingURL=index.dev.js.map
